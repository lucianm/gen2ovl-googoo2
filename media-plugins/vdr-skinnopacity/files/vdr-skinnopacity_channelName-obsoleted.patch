From 61d948968dea92152ba5a357598e668719600ce3 Mon Sep 17 00:00:00 2001
From: Lucian Muresan <lucianm@users.sourceforge.net>
Date: Thu, 6 Dec 2012 21:24:38 +0100
Subject: [PATCH] channelName detailed event obsoleted by Louis' patch

---
 displaymenu.c    | 6 +-----
 displaymenu.h    | 1 -
 menudetailview.c | 6 +++---
 menudetailview.h | 3 +--
 4 files changed, 5 insertions(+), 11 deletions(-)

diff --git a/displaymenu.c b/displaymenu.c
index bbd27e1..90bce73 100644
--- a/displaymenu.c
+++ b/displaymenu.c
@@ -17,7 +17,6 @@ cNopacityDisplayMenu::cNopacityDisplayMenu(void) {
 	lastTimersState = -1;
 	menuItemIndexLast = -1;
 	currentNumItems = 0;
-	channelName = NULL;
 	menuHasIcons = true;
 	detailView = NULL;
 	contentNarrow = true;
@@ -246,9 +245,6 @@ void cNopacityDisplayMenu::SetTitle(const char *Title) {
 		}
 		menuView->AdjustContentBackground(contentNarrow, contentNarrowLast);		
 		menuView->DrawHeaderLabel(left, title);
-		if (MenuCategory() == mcEvent) {
-			channelName = Title;
-		}
 	}
 }
 
@@ -415,7 +411,7 @@ void cNopacityDisplayMenu::SetEvent(const cEvent *Event) {
 	if (!Event)
 		return;
 	menuView->AdjustContentBackground(false, contentNarrowLast);
-	detailView = new cNopacityMenuDetailEventView(osd, Event, *channelName);
+	detailView = new cNopacityMenuDetailEventView(osd, Event);
 	menuView->SetDetailViewSize(dvEvent, detailView);
 	detailView->SetFonts();
 	if (config.displayRerunsDetailEPGView)
diff --git a/displaymenu.h b/displaymenu.h
index 5231ae8..002f3a1 100644
--- a/displaymenu.h
+++ b/displaymenu.h
@@ -28,7 +28,6 @@ private:
 	void DrawDisk(void);
 	void DrawTimers(void);
 	void SplitItem(const char *Text, cString *strItems, int *tabItems);
-	cString channelName;
 	virtual void Action(void);
 protected:
 	int Tab(int n);
diff --git a/menudetailview.c b/menudetailview.c
index 945f940..192f042 100644
--- a/menudetailview.c
+++ b/menudetailview.c
@@ -160,9 +160,8 @@ bool cNopacityMenuDetailView::Scroll(bool Up, bool Page) {
 
 //---------------cNopacityMenuDetailEventView---------------------
 
-cNopacityMenuDetailEventView::cNopacityMenuDetailEventView(cOsd *osd, const cEvent *Event, cString channelName) : cNopacityMenuDetailView(osd) {
+cNopacityMenuDetailEventView::cNopacityMenuDetailEventView(cOsd *osd, const cEvent *Event) : cNopacityMenuDetailView(osd) {
 	event = Event;
-	this->channelName = channelName;
 }
 
 cNopacityMenuDetailEventView::~cNopacityMenuDetailEventView(void) {
@@ -199,7 +198,8 @@ void cNopacityMenuDetailEventView::Render(void) {
 void cNopacityMenuDetailEventView::DrawHeader(void) {
 	cImageLoader imgLoader;
 	int logoWidth = config.detailViewLogoWidth;
-	if (imgLoader.LoadLogo(*channelName, logoWidth, config.detailViewLogoHeight)) {
+	cChannel *channel = Channels.GetByChannelID(event->ChannelID(), true);
+	if (channel && channel->Name() && imgLoader.LoadLogo(channel->Name(), logoWidth, config.detailViewLogoHeight)) {
 		pixmapLogo->DrawImage(cPoint(0, max((headerHeight - config.detailViewLogoHeight - border)/2, 0)), imgLoader.GetImage());
 	}
 	int widthTextHeader = width - 4 * border - logoWidth;
diff --git a/menudetailview.h b/menudetailview.h
index 8d1e864..16697f4 100644
--- a/menudetailview.h
+++ b/menudetailview.h
@@ -36,10 +36,9 @@ public:
 class cNopacityMenuDetailEventView : public cNopacityMenuDetailView {
 private:
 	void DrawHeader(void);
-	cString channelName;
 	const cEvent *event;
 public:
-	cNopacityMenuDetailEventView(cOsd *osd, const cEvent *Event, cString channelName);
+	cNopacityMenuDetailEventView(cOsd *osd, const cEvent *Event);
 	virtual ~cNopacityMenuDetailEventView(void);
 	void CreatePixmaps(void);
 	void SetFonts(void);
-- 
1.8.0

