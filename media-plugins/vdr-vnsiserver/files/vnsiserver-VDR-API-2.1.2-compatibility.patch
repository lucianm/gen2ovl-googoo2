From ddc07ca0d46aa646ca211231aa60636eec5137c3 Mon Sep 17 00:00:00 2001
From: Lucian Muresan <lucianm@users.sourceforge.net>
Date: Sun, 27 Oct 2013 21:48:49 +0100
Subject: [PATCH 287/287] VDR API 2.1.2 compatibility patch

---
 addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/videobuffer.c | 5 ++++-
 addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/vnsiclient.c  | 4 ++++
 addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/vnsiserver.c  | 4 ++++
 3 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/videobuffer.c b/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/videobuffer.c
index 0c26807..d83be07 100644
--- a/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/videobuffer.c
+++ b/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/videobuffer.c
@@ -386,8 +386,11 @@ bool cVideoBufferFile::Init()
       m_Filename = cString::sprintf("%s/Timeshift-%d.vnsi", TimeshiftBufferDir, m_ClientID);
   }
   else
+#if APIVERSNUM > 20101
+    m_Filename = cString::sprintf("%s/Timeshift-%d.vnsi", cVideoDirectory::Name(), m_ClientID);
+#else
     m_Filename = cString::sprintf("%s/Timeshift-%d.vnsi", VideoDirectory, m_ClientID);
-
+#endif
   m_Fd = open(m_Filename, O_RDWR | O_CREAT | O_TRUNC, S_IRWXU);
   if (m_Fd == -1)
   {
diff --git a/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/vnsiclient.c b/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/vnsiclient.c
index b724ce7..200259d 100644
--- a/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/vnsiclient.c
+++ b/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/vnsiclient.c
@@ -1403,7 +1403,11 @@ bool cVNSIClient::processTIMER_Update() /* OPCODE 85 */
 bool cVNSIClient::processRECORDINGS_GetDiskSpace() /* OPCODE 100 */
 {
   int FreeMB;
+#if APIVERSNUM > 20101
+  int Percent = cVideoDirectory::VideoDiskSpace(&FreeMB);
+#else
   int Percent = VideoDiskSpace(&FreeMB);
+#endif
   int Total   = (FreeMB / (100 - Percent)) * 100;
 
   m_resp->add_U32(Total);
diff --git a/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/vnsiserver.c b/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/vnsiserver.c
index 5748da8..a2a72f4 100644
--- a/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/vnsiserver.c
+++ b/addons/pvr.vdr.vnsi/vdr-plugin-vnsiserver/vnsiserver.c
@@ -213,7 +213,11 @@ void cVNSIServer::Action(void)
   }
   else
   {
+#if APIVERSNUM > 20101
+    cmd = cString::sprintf("rm -f %s/*.vnsi", cVideoDirectory::Name());
+#else
     cmd = cString::sprintf("rm -f %s/*.vnsi", VideoDirectory);
+#endif
   }
   int ret = system(cmd);
 
-- 
1.8.3.2

